---
title: "Southampton FC Transfermarkt Scraper"
author: "saintsnumbers"
output: github_document
date: 2019-07-28
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = FALSE)

#libraries
library(tidyverse)
library(rvest)
library(magrittr)
theme_set(theme_bw())


#delete environment variables
rm(list=ls())
```

## Scraping Southampton FC Transfermarkt data.

### Plan

* Load the webpage containing the data.
* Locate the data within the page and extract it.
* Organise the data into a dataframe

### Load the webpage

* [**Southampton FC Transfermarkt** (detailed)](https://www.transfermarkt.co.uk/southampton-fc/kader/verein/180/saison_id/2019/plus/1)
* [Page used in the example](https://www.transfermarkt.co.uk/manchester-city/startseite/verein/281/saison_id/2019)

```{r load}
page_url <- "https://www.transfermarkt.co.uk/southampton-fc/kader/verein/180/saison_id/2019/plus/1"
page_scraped <- read_html(page_url)
```

### Extract the data

Done | Needs tidying | Not done
-- | -- | --
Name | Height | DOB/Age
Squad Number | Foot | Contract
Position | | Joined

```{r extract}
player_names_raw <- page_scraped %>%
  html_nodes(".spielprofil_tooltip") %>%
  html_text()

player_names <- player_names_raw[seq(1,length(player_names_raw),2)] #duplicated - take odd numbered data only

player_numbers <- page_scraped %>%
  html_nodes(".rn_nummer") %>%
  html_text
player_numbers[player_numbers == "-"] <- NA

player_position <- page_scraped %>%
  html_nodes(".inline-table tr:nth-child(2) td") %>%
  html_text

player_height <- page_scraped %>%
  html_nodes("td:nth-child(5)") %>%
  html_text

player_foot <- page_scraped %>%
  html_nodes("td:nth-child(6)") %>%
  html_text

player_name_alt <- page_scraped %>%
  html_nodes(".posrela") %>%
  html_text
```

### Tidy data

```{r tidy}
player_data <- data.frame(Name = player_names, Number = player_numbers, Position = player_position, Height = player_height, Foot = player_foot)

player_data %<>%
  as_tibble
  
head(player_data,8)
```


### To do

* Turn into proper tibble
  + Done
* Try to get better html selectors process to avoid having to remove duplicated data
* Improve format of data as in table above