---
#title: "tracking"
#author: "szfh"
#date: "2020-04-12"
output: github_document
---

```{r setup, include=F}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(
  pacman,
  here,
  tidyverse,
  magrittr,
  readr,
  knitr,
  CodaBonito
)

# devtools::install_github("thecomeonman/CodaBonito")

cDataRootFolder = here("data","tracking")
cGameName = "Sample_Game_1"
nXLimit = 120
nYLimit = 80
dtData <- readRDS(here("data","tracking","Sample_Game_1","game1.rds"))
```

```{r parsedata, include=F, eval=F}
# run to parse data and save locally
game1 = fParseTrackingDataBothTeams(
   cRootPath = cDataRootFolder,
   cGameName = cGameName,
   nXLimit = nXLimit,
   nYLimit = nYLimit,
   xMaxBB = 1,
   yMaxBB = 1
)

saveRDS(game1, here("data","tracking","Sample_Game_1","game1.rds"))
```

## View data

```{r view, include=F}
dtData %>% str(give.attr=FALSE)
types <- dtData %>%
  select("Subtype") %>%
  distinct()
```

```{r slice}
# all slices matching subtype
dtTrackingSliceAll <- dtData %>%
  filter(
    Frame %in% outer(
      (Frame[
        which(
          Subtype == "ON TARGET-GOAL")]),
    -10:10,"+"))

# random slice matching subtype
dtTrackingSliceRandom <- dtData %>%
  filter(
    Frame %in%
      outer(
        sample(
          Frame[which(Subtype=="CORNER KICK")],1
        ),
        -2:2,"+")
  )

# given slice matching subtype
dtTrackingSliceGiven <- dtData %>%
  filter(
    Frame %in%
      outer(
        Frame[which(Subtype=="CORNER KICK")][[1]],
      -2:2,"+")
  )
```

```{r plot}
voronoiOutput = fDrawVoronoiFromTable(
   dtTrackingSliceGiven,
   nXLimit = nXLimit,
   nYlimit = nYlimit,
   UseOneFrameEvery = 1
)

print(voronoiOutput)
ggsave((here("plots","tracking","voronoi1.jpg")))
```
